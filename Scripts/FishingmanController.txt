local b = book.GetComponent("BookController")
local weather = book.GetComponent("WeatherController")

local commandNames = {}
commandNames["page0"]= 0
commandNames["page1"]= 4
commandNames["page2"]= 12
commandNames["page3"]= 20
commandNames["page4"]= 27
commandNames["page5"]= 34
commandNames["page6"]= 41
commandNames["page7"]= 48
commandNames["page8"]= 55
commandNames["page9"]= 62
commandNames["page10"]= 69

function nextPage()
	local res = b.swipeLeftHandle()

	if (res == true) then
		local curPageNumber = b.getCurrentPageNumber()
		local commandIndex = 0

		local command = string.format("page%d", curPageNumber)
		print("nextPage");
		print(command);
		commandIndex = commandNames[command]
		print("commandIndex")
		print(commandIndex)
		local block = flowchart.FindBlock("Start")

		--block.JumpToCommandIndex = commandIndex
		--block.Execute()

		if (block.State == 1) then
			print("Block is still available")
			block.JumpToCommandIndex = commandIndex
			block.Execute()

		else
			print("Block is not available")
			runblock(flowchart, "Start", commandIndex, true)
		end

	end
end


function backPage()
	local res = b.swipeRightHandle()

	if (res == true) then
		local curPageNumber = b.getCurrentPageNumber()
		local commandIndex = 0

		local command = string.format("page%d", curPageNumber)
		print("backPage")
		print(command)
		commandIndex = commandNames[command]
		print("commandIndex")
		print(commandIndex)
		local block = flowchart.FindBlock("Start")
--		block.JumpToCommandIndex = commandIndex
--		block.Execute()

		if (block.State == 1) then
			print("Block is still available")
			block.JumpToCommandIndex = commandIndex
			block.Execute()

		else
			print("Block is not available")
			runblock(flowchart, "Start", commandIndex, true)
		end

	end
end

function resetAnimationFlag()
	b.resetAnimationFlag()
end

function fishDiving()
	local clip = "CloseLeftItemsPage"
	b.playAnimationNextPage(clip)
end

function invokeLightningStrikeInCoInSuccession()
	print("invokeLightning")
	weather.InvokeLightningStrikeInCoInSuccession()
end

function weatherForPage(page)
		weather.transitionDurationChanged(4)
		weather.invokeCloud(false)
		--house (lodge)
		if (page == 1) then
			weather.invokeWind(false)
			weather.invokeRainByLevel(false, 0)

		--ocean
		elseif page == 2 then
			weather.invokeWind(true)
			weather.invokeRainByLevel(false, 0)

		--house (lodge)
		elseif page == 3 then
			weather.invokeWind(false)
			weather.invokeRainByLevel(false, 0)

		--ocean
		elseif page == 4 then
			weather.invokeWind(true)
			weather.invokeRainByLevel(false, 0)

		--house	(building)
		elseif page == 5 then
			weather.invokeWind(false)
			weather.invokeRainByLevel(false, 0)

		--ocean
		elseif page == 6 then
			weather.invokeWind(true)
			weather.invokeRainByLevel(true, 2)

		--house (castle)
		elseif page == 7 then
			weather.invokeWind(false)
			weather.invokeRainByLevel(true, 1)

		--ocean
		elseif page == 8 then
			weather.invokeWind(true)
			weather.invokeRainByLevel(true, 4)
			weather.invokeCloud(true)
			weather.InvokeLightningStrikeInCoInSuccession()

		--house (lodge)
		elseif page == 9 then
			weather.invokeWind(false)
			weather.invokeCloud(true)
			weather.invokeRainByLevel(true, 2)

		--finish
		elseif page == 10 then
			weather.invokeWind(false)
			weather.invokeRainByLevel(false, 0)

		else
			weather.invokeWind(false)
			weather.invokeRainByLevel(false, 0)
		end

end
